[[A01 JS解説1]]

```js
{ 
  // IDが baseDate の入力要素を取得（基準日を入力するフィールド）
  const baseInput = document.getElementById("baseDate"); 

  // IDが days の入力要素を取得（日数を入力するフィールド）
  const daysInput = document.getElementById("days");

  // IDが resultDate の入力要素を取得（計算結果を表示するフィールド）
  const resultInput = document.getElementById("resultDate");

  // IDが calcBtn のボタン要素を取得（計算実行ボタン）
  const btn = document.getElementById("calcBtn");

  // デフォルトで今日の日付を入力欄にセットする処理
  const today = new Date();  // 今日の日付を取得
  baseInput.value = today.toISOString().slice(0, 10); // YYYY-MM-DD形式に整形してセット

  // ボタンがクリックされたときの処理を登録
  btn.addEventListener("click", () => {
    const baseDate = baseInput.value;  // 入力された基準日を取得
    const days = parseInt(daysInput.value, 10);  // 入力された日数を整数として取得

    // 日数が数値でなければエラーメッセージを表示して処理終了
    if (isNaN(days)) {
      resultInput.value = "日数を入力してください";
      return;
    }

    // calculateDate関数で日付計算を実行
    const result = calculateDate(baseDate, days);

    // 計算結果が有効なら表示、無効ならエラーメッセージを表示
    resultInput.value = result || "入力が不正です";
  });
}
```
`document.addEventListener("DOMContentLoaded", () => {` は、**ウェブページのHTMLが全て読み込まれ、DOM（Document Object Model）の構築が完了した時点で、指定した処理を実行する**ためのJavaScriptのコードです。

HTML読込(DOM構築)完了　→　実行

ウェブページがブラウザに表示される際、ブラウザは上から順にHTMLファイルを読み込んでいきます。しかし、画像やCSSファイルなどの関連ファイルの読み込みが完了する前にJavaScriptが実行されてしまうと、まだ存在しないHTML要素を操作しようとしてエラーが発生することがあります。

この問題を解決するために、`DOMContentLoaded`イベントが使用されます。

---

## コードの内訳

この一行は、いくつかの要素から構成されています。

- `document`: 現在のウェブページ全体を表すオブジェクトです。
    
- `.addEventListener()`: `document`オブジェクトに対して、特定のイベントが発生した際に実行する処理（イベントリスナー）を登録するためのメソッドです。
    
- `"DOMContentLoaded"`: イベントの種類を指定します。これは、HTMLの解析とDOMツリーの構築が完了したときに発生するイベントです。画像の読み込みやスタイルシートの適用が完了していなくても、このイベントは発生します。
    
- `() => { ... }`: 実行される処理を定義する「アロー関数」です。`{}`の中に、DOMの準備ができた後で実行したいJavaScriptコードを記述します。
    

---

## 具体的な使用例

例えば、特定のHTML要素（例: IDが`myButton`のボタン）がクリックされたときにメッセージを表示したい場合、以下のように記述します。

JavaScript

```
document.addEventListener("DOMContentLoaded", () => {
  // DOMの準備ができた後にこの中のコードが実行される

  const myButton = document.getElementById("myButton");

  if (myButton) {
    myButton.addEventListener("click", () => {
      alert("ボタンがクリックされました！");
    });
  }
});
```

このコードにより、ブラウザが`myButton`というIDを持つ要素を確実に認識した後に、そのボタンに対するクリックイベントのリスナーが設定されるため、エラーなく意図した通りに動作します。

---

## `window.onload`との違い

似たようなイベントに`window.onload`があります。両者の主な違いは、処理が実行されるタイミングです。

- **`DOMContentLoaded`**: HTMLとDOMツリーの準備ができた時点で実行されます。画像やCSSなどの読み込みは待ちません。そのため、一般的に`window.onload`よりも速く実行されます。
    
- **`window.onload`**: 画像、スタイルシート、iframeなど、ページ上のすべてのリソースが完全に読み込まれた後に実行されます。
    

DOM要素の操作のみが目的であれば、ページの表示速度を損なわない`DOMContentLoaded`の使用が推奨されます。

---

「`const baseInput = document.getElementById("baseDate");`」について簡潔に解説します。

---

これは、**HTML文書の中からIDが「baseDate」である要素を取得し、`baseInput`という名前の定数に格納する**ためのJavaScriptのコードです。

### コードの内訳

- **`const`**: `baseInput`という名前で「定数」を宣言しています。定数は、一度値を代入すると後から変更（再代入）できなくなります。
    
- **`baseInput`**: 宣言された定数の名前です。今後この名前を使って、取得したHTML要素を操作できます。
    
- **`document.getElementById("baseDate")`**:
    
    - `document`: 現在のウェブページ全体を表すオブジェクトです。
        
    - `.getElementById()`: 指定されたIDを持つHTML要素を文書中から探し出すための命令（メソッド）です。
        
    - `"baseDate"`: 探し出す要素のID名を指定しています。
        

### 具体例

例えば、HTMLに以下のような入力欄があったとします。

```HTML
<input type="date" id="baseDate">
```

このとき、先ほどのJavaScriptコードを実行すると、("baseDate"を持っている)`baseInput`という定数にこの`<input>`要素全体が格納されます。これにより、後続のコードで`baseInput.value`のようにして入力された値を取得したり、`baseInput.style.display = "none";`のようにして表示を操作したりすることが可能になります。

---

```
const days = parseInt(daysInput.value, 10);  // 入力された日数を整数として取得
```
の'10'は、JavaScriptの`parseInt()`関数で、文字列を整数に変換する際の**基数**（radix）を表します。これは、変換元の数字が何進数で表現されているかを指定するもので、`10`は**10進数**を意味します。

### **`parseInt()`関数の解説**

`parseInt()`関数は、文字列を解析して整数に変換するために使われます。構文は次のようになっています。

JavaScript

```js
parseInt(string, radix);
```

- **`string`**: 整数に変換したい文字列。
    
- **`radix`**: 変換元の文字列が何進数であるかを指定する整数。省略すると、`0x`で始まる場合は16進数、`0`で始まる場合は8進数と見なされ、それ以外は10進数と見なされます。しかし、予期せぬ挙動を避けるために、通常は**10を明示的に指定する**ことが推奨されます。
    

### **なぜ`10`が必要なのか？**

ご提示のコード「`const days = parseInt(daysInput.value, 10);`」では、ユーザーが入力した値は文字列として取得されます。この文字列を**確実に10進数の整数として扱う**ために、第2引数に`10`が指定されています。

たとえば、もしユーザーが「08」と入力した場合、`10`を指定しないと、一部の古いJavaScriptエンジンでは8進数と解釈されてしまい、予期せぬ結果（0）になる可能性があります。`10`を明示的に指定することで、この問題を回避し、常に正確な変換を保証できます。

[[A03 HTML 属性「for」]]
