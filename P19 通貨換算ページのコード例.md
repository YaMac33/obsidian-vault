[[P18 calculators／bmi.html と calculators／split-bill.html]]


ここでは **tools/currency-converter.html** と **js/calculators/currency-convert.js** の例を示します。  
外部APIを使用して最新の為替レートを取得し、簡単な通貨換算を行う仕様です。CORS対応に注意してください。
[[P02 GitHub PagesでのHTTPSとCORS対応の解説]]


---

## tools/currency-converter.html

```html
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>通貨換算ツール</title>
  <link rel="stylesheet" href="../css/tools.css">
</head>
<body>
  <header>
    <h1>通貨換算ツール</h1>
  </header>

  <main>
    <section class="tool-container">
      <label for="amount">金額:</label>
      <input type="number" id="amount" placeholder="例: 1000" required>

      <label for="fromCurrency">元の通貨:</label>
      <select id="fromCurrency">
        <option value="USD">USD</option>
        <option value="EUR">EUR</option>
        <option value="JPY" selected>JPY</option>
        <option value="BTC">BTC</option>
      </select>

      <label for="toCurrency">換算先の通貨:</label>
      <select id="toCurrency">
        <option value="USD">USD</option>
        <option value="EUR">EUR</option>
        <option value="JPY" selected>JPY</option>
        <option value="BTC">BTC</option>
      </select>

      <button id="convertBtn">換算する</button>

      <div id="result" class="result-box"></div>
    </section>
  </main>

  <footer>
    <p><a href="../index.html">← ホームに戻る</a></p>
  </footer>

  <script src="../js/utils.js"></script>
  <script type="module" src="../js/calculators/currency-convert.js"></script>
</body>
</html>
```

## js/calculators/currency-convert.js
```js
// ================================
// currency-convert.js : 通貨換算スクリプト
// ================================

import { isPositive } from "../validators.js";

const API_URL = "https://api.exchangerate.host/latest"; // 無料で使える為替API

async function getExchangeRates(base = "JPY") {
  try {
    const response = await fetch(`${API_URL}?base=${base}`);
    if (!response.ok) throw new Error("為替情報の取得に失敗");
    const data = await response.json();
    return data.rates;
  } catch (err) {
    console.error(err);
    alert("為替レートの取得に失敗しました");
    return null;
  }
}

async function convertCurrency(amount, from, to) {
  if (!isPositive(amount)) return null;
  if (from === to) return amount;

  const rates = await getExchangeRates(from);
  if (!rates || !rates[to]) return null;

  return amount * rates[to];
}

// DOM操作
document.addEventListener("DOMContentLoaded", () => {
  const amountInput = document.getElementById("amount");
  const fromSelect = document.getElementById("fromCurrency");
  const toSelect = document.getElementById("toCurrency");
  const resultBox = document.getElementById("result");
  const btn = document.getElementById("convertBtn");

  btn.addEventListener("click", async () => {
    const amount = parseFloat(amountInput.value);
    const from = fromSelect.value;
    const to = toSelect.value;

    const converted = await convertCurrency(amount, from, to);
    if (converted === null) {
      resultBox.textContent = "入力値または為替情報に問題があります";
      return;
    }

    resultBox.textContent = `${amount} ${from} ≒ ${converted.toFixed(2)} ${to}`;
  });
});
```

## 補足
- 無料API「[exchangerate.host](https://exchangerate.host/)」を使用
- GitHub Pages では HTTPS が標準なので、APIも HTTPS 対応が必要
- isPositive を使い、入力チェックを行っています
- 結果表示は小数点2桁に丸めています

---

※この記事はChatGPTの回答を基に作成しています。

[[P20 ローマ字変換ページのコード例]]